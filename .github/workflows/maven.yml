
name: Run Automation Tests

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: maven

      # Install Google Chrome on the runner
      - name: Install Google Chrome
        uses: browser-actions/setup-chrome@v1

      - name: Show Chrome version
        run: |
          which google-chrome || true
          google-chrome --version || /usr/bin/google-chrome --version || true

      # -------- Choose ONE of the two run steps below --------
      # Preferred: headless via DriverFactory
      - name: Build and Run Tests
        run: mvn -B -e clean test -Dci=true

      # Safety net (use if UI still fails): give Chrome a virtual display
      # - name: Build and Run Tests (xvfb)
      #   run: xvfb-run -a mvn -B -e clean test -Dci=true

      # Upload ChromeDriver verbose log (if your DriverFactory sets it)
      - name: Upload ChromeDriver log
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: chromedriver-log
          path: chromedriver.log

      # Upload Surefire reports when tests fail
      - name: Upload Surefire Reports
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: surefire-reports
          path: target/surefire-reports
